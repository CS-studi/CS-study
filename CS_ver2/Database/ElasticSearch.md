## Elasticsearch
> Apache Lucene에 구축되어 배포된 검색 및 분석 엔진

## 특징
1. 빠르다
    - 거의 실시간 검색 플랫폼이다.
    - Lucene기반으로 구축되어 풀텍스트 검색에 뛰어나다

2. 본질상 분산적이다
    - elasticsearch에 저장된 문서는 샤드라고 하는 여러 다른 컨테이너에 분산적으로 저장
    - 샤드는 복제되어 장애 대응 가능(replication)

3. 광범위한 기능 세트와 함께 제공된다
    - 데이터 롤업, 인덱스 수명 주기 관리 등과 같이 데이터를 더 효율적으로 저장하고 검색할 수 있게 하는 여러 기능 탑재

4. 데이터 수집, 시각화, 보고를 간소화한다.
    - 데이터를 더 쉽게 처리
    - kibana => 실시간 시각화, beats+logstash => 색인 전 데이터 쉽게 처리 가능

5. REST API가 제공된다

## 활용
- 애플리케이션 / 웹사이트 / 엔터프라이즈 검색
- 로깅과 로그 분석
- 인프라 메트릭과 컨테이너 / 애플리케이션 성능 모니터링
- 위치 기반 정보 데이터 분석 및 시각화
- 보안 / 비즈니스 분석

### 활용 예시
1. 고객이 판매 제품을 검색할 수 있는 온라인 웹 스토어를 운영합니다. 이 경우에는 Elasticsearch를 사용하여 전체 제품 카탈로그 및 재고 정보를 저장하고 그에 대한 검색 및 자동 완성 제안 기능을 제공할 수 있습니다.
2. 로그 또는 트랜잭션 데이터를 수집하고 이 데이터를 분석하고 마이닝하여 추이, 통게, 요약 정보를 얻거나 이상 요인을 알아내려 합니다.
3. 분석/비즈니스 인텔리전스 기능이 필요하며 방대한 데이터를 대상으로 신속하게 조사, 분석, 시각화, 임시 질의를 수행하고 싶습니다. 이 경우에는 Elasticsearch를 사용하여 데이터를 저장한 다음 Kibana를 사용하여 데이터 중 중요한 요소를 시각화할 맞춤형 대시보드를 만들 수 있습니다. 또한 Elasticsearch 집계 기능을 사용하여 데이터에 대한 복잡한 비즈니스 인텔리전스 쿼리를 수행할 수 있습니다.

## Elasticsearch 인덱스
> Elasticsearch 인덱스는 서로 관련되어 있는 문서들의 모임
Elasticsearch는 JSON 문서로 데이터를 저장합니다. 각 문서는 일련의 키(필드나 속성의 이름)와 그에 해당하는 값(문자열, 숫자, 배열, 지리적 위치 또는 기타 데이터 유형)을 서로 연결합니다.

Elasticsearch는 역 인덱스라고 하는 데이터 구조를 사용하는데, 이것은 아주 빠른 풀텍스트 검색을 할 수 있도록 설계된 것입니다. 역 인덱스는 문서에 나타나는 모든 고유한 단어의 목록을 만들고, 각 단어가 발생하는 모든 문서를 식별합니다.

색인 프로세스 중에, Elasticsearch는 문서를 저장하고 역 인덱스를 구축하여 거의 실시간으로 문서를 검색 가능한 데이터로 만듭니다. 인덱스 API를 사용해 색인이 시작되며, 이를 통해 사용자는 특정한 인덱스에서 JSON 문자를 추가하거나 업데이트할 수 있습니다.

## Elastic stack
> 사용자가 서버로부터 원하는 모든 유형의 데이터를 가져와서 실시간으로 해당 데이터를 검색, 분석 및 시각화 할 수 있도록 도와주는 Elastic의 오픈소스 서비스 제품입니다.
> 기존 ELK(Elasticsearch + Logstash + Kibana)에 Beats가 포함

- Logstash: 다양한 소스(DB, csv 파일 등)의 로 또는 트랜잭션 데이터를 수집, 집계, 파싱하여 Elasticsearch로 전달
- Elasticsearch: Logstash로부터 받은 데이터를 검색 및 집계를 하여 필요한 관심 있는 정보를 획득
- Kibana: Elasticsearch의 빠른 검색을 통해 데이터를 시각화 및 모니터링
- Beats: 경량 데이터 수집기. 단일 목적의 데이터 수집기 오픈 소스 플랫폼으로 수백 수천 개의 장비와 시스템으로부터 Logstash나 Elasticsearch로 데이터를 전송한다.

## ElasticSearch 구조
###  Cluster
- elasticsearch 내 가장 큰 시스템 단위
- 최소 하나 이상의 노드로 이루어진 노드의 집합
- 서로 다른 클러스터는 데이터의 접근 교환을 할 수 없음, 독립적인 시스템으로 유지
- 여러대의 서버가 하나의 클러스터를 구성할 수 있고 한 서버에 여러 개의 클러스터가 존재할 수 있다.

### Node
- 노드는 클러스터에 포함된 단일 서버로서 데이터를 저장하고 클러스터의 색인화 및 검색 기능에 참여한다.

- mater-eligible
    - 클러스터를 제어하는 마스터로 선택할 수 있는 노드이다.
    - 인덱스 생성, 삭제
    - 클러스터 노드의 추적, 관리
    - 데이터 입력 시 할당할 샤드 선택
- data
    - document가 저장되는 노드이며 데이터가 분산 저장되는 물리적 공간인 샤드가 배치되는 노드이다. CRUD 색인, 검색, 통계 등의 데이터 작업을 수행하므로 많은 리소스가 필요
- ingest
    - 데이터를 변환하는 등 사전 처리 파이프라인을 실행하는 역할을 한다
- coordination only node
    - 사용자의 요청을 받고 라운드 로빈 방식으로 분산을 하는 노드

### Index
- RDBMS에서 데이터베이스와 대응하는 개념

### Shard
- 인덱스 내부에는 색인된 데이터들이 존재하는데 이 데이터들이 물리적 공간에 여러 개로 나뉘어서 존재하는 부분
- 스케일 아웃을 위해 하나의 인덱스를 여러 샤드로 쪼갰다고 생각하면 된다

### Segment
- Elasticsearch에서 문서의 빠른 검색을 위해 설계된 자료 구조
- 샤드의 데이터를 가지고 있는 물리적인 파일
- 각 샤드는 다수의 세그먼트로 구성되어 있으므로 검색 요청을 분산 처리하여 훨씬 효율적인 검색이 가능하다
- 샤드에서 검색 시, 먼저 각 세그먼트를 검색하여 결과를 조합한 후 최종 결과를 해당 샤드의 결과로 리턴하게 된다

## ElasticSearch 작동
JSON 문서 형식의 데이터를 Logstash 및 수집 도구나 API를 사용해 Elasticsearch로 전송할 수 있습니다.

Elasticsearch는 자동으로 원래 문서를 저장하고 클러스터의 인덱스에 문서에 대한 검색 가능한 참조를 추가합니다. Elasticsearch API를 사용해 문서를 검색하고 조회할 수 있습니다. 

또한 시각화 도구인 Kibana를 Elasticsearch와 함께 사용해 데이터를 시각화하고 대화식 대시보드를 구축할 수 있습니다.
