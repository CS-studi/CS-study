# RDBMS & NoSQL , CAP 이론

# RDBMS

관계형 데이터베이스 관리 시스템

> 특징
> 
- 관계형 : 데이터간에 관계를 가지며 여러 테이블에 분산되어 저장된다.
- 스키마 : 스키마에 정해진 규칙에 맞는 데이터만 저장된다.
- Scaling Out이 번거롭다 (NoSQL에 비해)
- 트랜잭션 : 트랜잭션을 통해 데이터 일관성을 보장한다. (ACID)
- CA(consistency + availability) 시스템

> 장점
> 
- 관계라는 개념으로 데이터 중복을 줄인다. (외래키)
- 데이터 변경(update) 시에도 일관성을 유지할 수 있다. (외래키)
- 저장되는 데이터의 무결성이 보장된다 (스키마)

> 단점
> 
- Scaling Out이 번거롭다
- 저장되는 데이터 형태가 제한된다. (스키마)

# NoSQL

비 관계형 데이터베이스 (Not Only SQL)

- 등장 배경 : 빅데이터의 등장으로 RDB 서버의 Scaling Out이 필요했지만 특성상 부적합 → Scaling Out이 가능한 NoSQL이 등장하게 되었다.

> 특징
> 
- 비관계형 : 저장되는 데이터들 사이에 관계가 존재하지 않는다.
- 비스키마 : 저장되는 데이터에 대한 규칙이 없다 (서로 다른 구조의 데이터를 같은 컬랙션에 저장할 수 있다)
- Scaling Out, Scailing Up이 용이하다
- 트랜잭션을 완벽하게 지원하지 않는다 → 궁극적 데이터 일관성을 제공한다.
- CP(consistency + partition tolerance) 또는 AP(availability + partition tolerance) 시스템 → 분산형 구조 (무중단 서비스 제공이 가능)

> 장점
> 
- 스키마가 없기 때문에 데이터 구조에 대한 제약이 적다
- READ 연산 속도가 빠르다
- Scaling Out, Scaling Up이 용이하다 (RDB에 비해)

> 단점
> 
- 저장되는 데이터의 구조를 개발자가 직접 정의해야 한다.
- 데이터 변경(update)시 중복문제로 인한 데이터 일관성이 깨지기 쉽다. (외래키라는 개념이 없음)

> NoSQL의 데이터 저장 방식
> 

`Key-Value`

- key(데이터의 고유 식별자)- value(데이터) 쌍으로 저장한다.
- 파티셔닝, Scaling Out이 용이하다
- Redis, Voldmort

`Document`

- 저장되는 데이터 타입이 Document으로 JSON 형태의 구조를 띈다.
- Document들을 Collection으로 관리한다. (Collection에는 Document Id가 저장되어 있다)
- WRITE보다 READ 연산이 많은 시스템에 적합한 데이터 저장 방식이다.
- Mongo DB, Elasticsearch

`Column Model`

- 하나의 key(데이터 고유 식별자)에 column(이름)-column(값) 쌍의 데이터를 저장한다.
- Column은 이름, 값, timestamp으로 구성된다.
- READ보다 WRITE 연산이 많은 시스템에 적합하다
- 구글의 Big Table

`Graph`

- 데이터를 노드로 표현하고, 노드 사이의 관계를 화살표로 표현한다.
- 데이터 사이의 관계가 중요한 시스템에 적합하다

# ****RDBMS vs NoSQL****

`RDBMS가 적합한 경우`

- 데이터 구조가 변경될 여지가 없고, 저장되는 데이터의 규칙이 중요한경우
- 데이터들간에 관계를 맺고 있고, 데이터가 자주 변경되는 경우

`NoSQL이 적합한 경우`

- 저장되는 데이터의 명확한 구조를 알 수 없고, 구조가 자주 변경되는 경우
- READ연산이 많고 WRITE 연산이 적은 경우
- 막대한 양의 데이터를 저장하고 관리해야 하는 경우

# CAP 이론

네트워크로 연결된 분산 데이터베이스 시스템은 CAP라는 3가지 특성중 오직 2가지만 만족할 수 있다는 이론

- CAP : Consistency(일관성), Availability(가용성), Partition Tolerance(분할 내구성)

> 일관성
> 

여러 클라이언트에서 같은 시점에 조회하는 데이터는 항상 동일해야 한다는 특성

- 트랜잭션 매커니즘이 필요한 특성
- RDBMS에서 기본적으로 지원하지만, NoSQL에서는 기본적으로 지원하지 않는다.
- NoSQL에서는 궁극적 일관성(최종 일관성)을 지원한다.
    - 궁극적 일관성 : 일관성을 실시간으로 보장하지 않고, 궁극적으로 언젠가는 일관성을 보장한다는 의미

NoSQL의 궁극적 일관성

- 동기식 일관성 유지법
    - 데이터가 업데이트 되면, 클라이언트에 응답하기 전에 서버에 존재하는 모든 데이터에 변경사항을 반영한 뒤에 응답하는 방법
    - 응답시간이 느리지만 데이터 일관성을 보장한다
- 비동기식 일관성 유지법
    - 데이터가 업데이트 되면, 변경사항을 임시 파일에 기록해둔다. 이후 변경사항을 반영하면서 클라이언트의 요청이 들어오면 응답한 뒤에 나머지 서버에 변경사항을 반영한다.
    - 응답시간이 빠르지만, 변경사항을 반영하는 도중 에러가 발생하면 데이터가 손실될 수 있다.

> 가용성
> 

죽지 않은 상태의 모든 서버는 클라이언트에게 항상 정상 처리 응답을 보애주어야 한다는 것을 의미한다

- 특정 노드에 장애가 발생해도, 다른 노드들을 통해 서비스를 지속할 수 있다
- NoSQL은 Replication이 용이하기 때문에 쉽게 `가용성`을 보장한다.
    - Primary-Secondary 방식의 Replication이 있다.

> 분할 내구성
> 

지역적으로 분할된 네트워크 환경에서, 두 지역간의 네트워크가 단절되어 서로 통신을 할 수 없어도 각각 지역내의 DB 시스템은 정삭적으로 동작해야한다는 특성

- RDBMS는 분산 구조를 취할 수 있으나 리스크가 크다.
    - Replication으로 분산구조를 취할 경우 → 퍼포먼스 이슈
    - Sharding으로 분산구조를 취할 경우 → 데이터 관계가 무너져 신뢰성이 깨지는 이슈

## CAP 조합

> CA → RDBMS
> 

관계형 데이터베이스는 CA 시스템이다. 

- 일관성(C)와 가용성(A)를 보장하되, 분단 허용성(P)는 보장하지 않는다

> CP, AP → NoSQL
> 

대부분의 NoSQL 데이터베이스는 CA가 아닌 CP나 AP 시스템이다.

- 대용량의 분산 시스템을 구축하는 경우엔 CP보다 **AP가 적합하다**.
    
    C(일관성) 특성이 포함되면 트랜잭션을 통해 일관성을 유지하고, 이는 Lock 매커니즘이 적용된다. 많은 노드가 존재한다면, 데이터에 Lock이 걸리는 시간이 늘어나 A(가용성)을 해친다. 따라서 대용량 분산 시스템의 경우 CP보다 AP가 적합하다.
